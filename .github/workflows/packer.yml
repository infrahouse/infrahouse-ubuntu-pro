---
name: 'Packer AMI build'

on:  # yamllint disable-line rule:truthy
  pull_request:


permissions:
  id-token: write  # This is required for requesting the JWT
  contents: read
  pull-requests: write

jobs:
  build:
    name: 'Build AMI'
    runs-on: ["self-hosted", "Linux", "noble"]

    # Use the Bash shell regardless whether the GitHub Actions runner is ubuntu-latest, macos-latest, or windows-latest
    defaults:
      run:
        shell: bash

    steps:
      # Checkout the repository to the GitHub Actions runner
      - name: Checkout
        uses: actions/checkout@v4

      - name: Configure AWS Credentials
        uses: aws-actions/configure-aws-credentials@v4
        with:
          role-to-assume: arn:aws:iam::303467602807:role/ih-tf-infrahouse-ubuntu-pro-github
          role-session-name: packer-build
          aws-region: "us-west-1"

      - name: Packer init
        run: packer init .

      - name : Packer build
        run: packer build .
